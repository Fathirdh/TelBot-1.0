<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portal Rekrutmen Telkom Indonesia">
    <title>Karir Telkom - Wujudkan Masa Depan Digital</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <style>
        :root {
            --chat-red:       #E10600;
            --chat-red-dark:  #B80500;
            --chat-red-light: #FF1A16;
            --chat-red-glow:  rgba(225,6,0,0.22);
            --chat-radius:    20px;
            --chat-shadow:    0 20px 60px rgba(0,0,0,0.20);
        }

        #chat-toggle {
            position: fixed;
            bottom: 28px;
            right: 28px;
            width: 58px;
            height: 58px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--chat-red-light), var(--chat-red-dark));
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 20px var(--chat-red-glow), 0 2px 8px rgba(0,0,0,0.18);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s cubic-bezier(.34,1.56,.64,1), box-shadow 0.3s ease;
            z-index: 9999;
        }
        #chat-toggle:hover { transform: scale(1.10); box-shadow: 0 6px 28px var(--chat-red-glow), 0 4px 12px rgba(0,0,0,0.22); }
        #chat-toggle:active { transform: scale(0.95); }
        #chat-toggle .icon-chat, #chat-toggle .icon-close {
            position: absolute;
            transition: opacity 0.25s ease, transform 0.25s ease;
        }
        #chat-toggle .icon-close  { opacity: 0; transform: rotate(-90deg) scale(0.7); }
        #chat-toggle.open .icon-chat  { opacity: 0; transform: rotate(90deg) scale(0.7); }
        #chat-toggle.open .icon-close { opacity: 1; transform: rotate(0deg) scale(1); }
        #chat-notif {
            position: absolute; top: 4px; right: 4px;
            width: 12px; height: 12px;
            background: #FFD600; border-radius: 50%; border: 2px solid white;
            animation: notif-pulse 2s infinite;
        }
        @keyframes notif-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           KUNCI UTAMA FIX:
           Chat window pakai height tetap + flex column.
           Semua bagian (header, messages, input, footer)
           punya flex-shrink: 0 KECUALI messages yang flex: 1.
           Ini memastikan input TIDAK PERNAH tertutup.
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        #chat-window {
            position: fixed;
            bottom: 100px;
            right: 28px;
            width: 375px;
            height: 580px;                        /* tinggi tetap */
            max-height: calc(100vh - 120px);      /* batas layar */
            border-radius: var(--chat-radius);
            background: #ffffff;
            box-shadow: var(--chat-shadow), 0 0 0 1px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;               /* susun vertikal */
            overflow: hidden;                     /* clip konten */
            z-index: 9998;
            opacity: 0;
            transform: translateY(24px) scale(0.96);
            pointer-events: none;
            transition: opacity 0.3s cubic-bezier(.4,0,.2,1), transform 0.3s cubic-bezier(.34,1.56,.64,1);
            transform-origin: bottom right;
        }
        #chat-window.open {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        /* Header ‚Äî ukuran tetap */
        .chat-header {
            background: linear-gradient(135deg, var(--chat-red) 0%, var(--chat-red-dark) 100%);
            padding: 18px 20px 16px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        .chat-header::before {
            content: ''; position: absolute; top: -30px; right: -30px;
            width: 120px; height: 120px; border-radius: 50%; background: rgba(255,255,255,0.08);
        }
        .chat-header::after {
            content: ''; position: absolute; bottom: -20px; right: 40px;
            width: 70px; height: 70px; border-radius: 50%; background: rgba(255,255,255,0.06);
        }
        .chat-header-top { display: flex; align-items: center; gap: 12px; position: relative; z-index: 1; }
        .chat-avatar {
            width: 44px; height: 44px; border-radius: 50%;
            background: rgba(255,255,255,0.18); border: 2px solid rgba(255,255,255,0.4);
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
            font-family: 'Poppins', sans-serif; font-size: 18px; font-weight: 700; color: white;
        }
        .chat-header-name { color: white; font-family: 'Poppins', sans-serif; font-size: 15px; font-weight: 700; letter-spacing: -0.2px; line-height: 1.2; }
        .chat-header-status { display: flex; align-items: center; gap: 5px; margin-top: 3px; }
        .chat-status-dot {
            width: 7px; height: 7px; border-radius: 50%; background: #4ADE80;
            box-shadow: 0 0 0 2px rgba(74,222,128,0.3); animation: status-blink 2.5s infinite;
        }
        @keyframes status-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.45; } }
        .chat-status-text { color: rgba(255,255,255,0.80); font-family: 'Poppins', sans-serif; font-size: 11.5px; font-weight: 400; }
        .chat-header-tagline { margin-top: 13px; position: relative; z-index: 1; }
        .chat-header-tagline p { color: rgba(255,255,255,0.82); font-family: 'Poppins', sans-serif; font-size: 12.5px; font-weight: 300; line-height: 1.55; }
        .chat-header-tagline strong { color: white; font-weight: 600; }

        /* Messages ‚Äî flex: 1 agar ambil semua sisa ruang & scroll di dalam */
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 14px 14px 10px;
            display: flex;
            flex-direction: column;
            gap: 9px;
            background: #F7F7F7;
            scroll-behavior: smooth;
            /* TIDAK ada min-height / max-height ‚Äî flex yang mengatur */
        }
        #chat-messages::-webkit-scrollbar { width: 4px; }
        #chat-messages::-webkit-scrollbar-track { background: transparent; }
        #chat-messages::-webkit-scrollbar-thumb { background: #DEDEDE; border-radius: 4px; }

        .chat-msg { max-width: 84%; animation: msg-appear 0.25s cubic-bezier(.34,1.56,.64,1) forwards; opacity: 0; }
        @keyframes msg-appear {
            from { opacity: 0; transform: translateY(10px) scale(0.96); }
            to   { opacity: 1; transform: translateY(0) scale(1); }
        }
        .chat-msg.bot  { align-self: flex-start; }
        .chat-msg.user { align-self: flex-end; }
        .chat-bubble {
            padding: 10px 14px; border-radius: 17px;
            font-family: 'Poppins', sans-serif; font-size: 13px; line-height: 1.58;
            word-break: break-word; white-space: pre-wrap;
        }
        .chat-msg.bot  .chat-bubble { background: white; color: #222; border-bottom-left-radius: 5px; box-shadow: 0 1px 6px rgba(0,0,0,0.08); }
        .chat-msg.user .chat-bubble { background: linear-gradient(135deg, var(--chat-red-light), var(--chat-red-dark)); color: white; border-bottom-right-radius: 5px; box-shadow: 0 2px 10px var(--chat-red-glow); }
        .chat-msg-time { font-family: 'Poppins', sans-serif; font-size: 10px; color: #AAAAAA; margin-top: 3px; padding: 0 3px; }
        .chat-msg.user .chat-msg-time { text-align: right; }

        .chat-typing {
            align-self: flex-start; background: white; border-radius: 17px; border-bottom-left-radius: 5px;
            padding: 11px 15px; box-shadow: 0 1px 6px rgba(0,0,0,0.08); display: flex; gap: 5px; align-items: center;
        }
        .chat-typing span { width: 7px; height: 7px; background: #AAAAAA; border-radius: 50%; animation: typing-bounce 1.2s infinite; }
        .chat-typing span:nth-child(2) { animation-delay: 0.2s; }
        .chat-typing span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-bounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-6px); } }

        /* Quick replies ‚Äî ukuran tetap */
        #chat-quick-replies {
            padding: 9px 14px 5px; display: flex; flex-wrap: wrap; gap: 6px;
            background: #F7F7F7; border-top: 1px solid #EBEBEB;
            flex-shrink: 0;
        }
        #chat-quick-replies button {
            background: white; border: 1.5px solid #E0E0E0; color: var(--chat-red);
            font-family: 'Poppins', sans-serif; font-size: 11.5px; font-weight: 600;
            padding: 5px 11px; border-radius: 20px; cursor: pointer;
            transition: all 0.2s ease; white-space: nowrap;
        }
        #chat-quick-replies button:hover {
            background: var(--chat-red); border-color: var(--chat-red); color: white;
            transform: translateY(-1px); box-shadow: 0 3px 10px var(--chat-red-glow);
        }

        /* Input area ‚Äî ukuran tetap, TIDAK BOLEH tertutup */
        .chat-input-area {
            padding: 11px 14px 14px; background: white; border-top: 1px solid #EBEBEB;
            display: flex; gap: 9px; align-items: flex-end;
            flex-shrink: 0;
        }
        #chat-input {
            flex: 1; border: 1.5px solid #E0E0E0; border-radius: 13px; padding: 9px 13px;
            font-family: 'Poppins', sans-serif; font-size: 13px; color: #222; background: #F7F7F7;
            outline: none; resize: none; min-height: 40px; max-height: 100px; overflow-y: auto;
            transition: border-color 0.2s ease, background 0.2s ease; line-height: 1.5;
        }
        #chat-input:focus { border-color: var(--chat-red); background: white; box-shadow: 0 0 0 3px rgba(225,6,0,0.07); }
        #chat-input::placeholder { color: #AAAAAA; }
        #chat-input:disabled { opacity: 0.6; cursor: not-allowed; }
        #chat-send {
            width: 40px; height: 40px; border-radius: 11px;
            background: linear-gradient(135deg, var(--chat-red-light), var(--chat-red-dark));
            border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
            box-shadow: 0 3px 12px var(--chat-red-glow);
        }
        #chat-send:hover:not(:disabled) { transform: scale(1.08) translateY(-1px); box-shadow: 0 5px 18px var(--chat-red-glow); }
        #chat-send:active:not(:disabled) { transform: scale(0.95); }
        #chat-send:disabled { opacity: 0.40; cursor: not-allowed; }

        /* Footer ‚Äî ukuran tetap */
        .chat-footer {
            padding: 7px 14px 9px; text-align: center; background: white;
            border-top: 1px solid #F3F3F3;
            flex-shrink: 0;
        }
        .chat-footer span { font-family: 'Poppins', sans-serif; font-size: 10.5px; color: #AAAAAA; font-weight: 400; }
        .chat-footer strong { color: var(--chat-red); }

        @media (max-width: 440px) {
            #chat-window { width: calc(100vw - 20px); right: 10px; bottom: 84px; height: auto; max-height: 75vh; }
            #chat-toggle { right: 14px; bottom: 14px; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <div class="nav-brand">
                <span class="logo-text"><span style="color: var(--primary-color);">Telkom</span>Careers</span>
            </div>
            <button class="hamburger" id="hamburger">
                <span></span><span></span><span></span>
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="#beranda" class="active">Beranda</a></li>
                <li><a href="#lowongan">Lowongan</a></li>
                <li><a href="#program-magang">Program Magang</a></li>
                <li><a href="#tentang-kami">Tentang Kami</a></li>
            </ul>
        </div>
    </nav>

    <header class="hero" id="beranda">
        <div class="container hero-container">
            <div class="hero-content fade-up">
                <span class="hero-badge">Rekrutmen & Magang 2026</span>
                <h1>Bangun Karir Digitalmu Bersama <span class="text-highlight">Telkom</span></h1>
                <p>Bergabunglah dengan Telkom Indonesia untuk menciptakan inovasi digital yang berdampak bagi nusantara.</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary">Eksplor Lowongan</button>
                    <button class="btn btn-outline">Pelajari Program</button>
                </div>
            </div>
            <div class="hero-visual fade-up delay-200">
                <div class="abstract-shape shape-1"></div>
                <div class="abstract-shape shape-2"></div>
                <div class="tech-dots"></div>
            </div>
        </div>
    </header>

    <!-- CHATBOT WIDGET -->
    <button id="chat-toggle" aria-label="Buka chat Helpdesk Rekrutmen">
        <div id="chat-notif"></div>
        <svg class="icon-chat" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
             fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="26" height="26">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
             fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" width="22" height="22">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
    </button>

    <div id="chat-window" role="dialog" aria-label="Chat Helpdesk Rekrutmen Telkom Indonesia">
        <div class="chat-header">
            <div class="chat-header-top">
                <div class="chat-avatar">T</div>
                <div>
                    <div class="chat-header-name">Telkom Indonesia</div>
                    <div class="chat-header-status">
                        <div class="chat-status-dot"></div>
                        <span class="chat-status-text">Helpdesk Rekrutmen ¬∑ Online</span>
                    </div>
                </div>
            </div>
            <div class="chat-header-tagline">
                <p>Selamat datang! Tanya apapun seputar <strong>rekrutmen & karir Telkom</strong> ‚Äî kami siap membantu 24/7.</p>
            </div>
        </div>

        <div id="chat-messages"></div>

        <div id="chat-quick-replies">
            <button onclick="chatSendQuick('Cara ganti email lama')">Ganti Email</button>
            <button onclick="chatSendQuick('Tidak bisa login')">Login</button>
            <button onclick="chatSendQuick('Reschedule online test')">Reschedule Tes</button>
            <button onclick="chatSendQuick('Password SEB')">Password SEB</button>
            <button onclick="chatSendQuick('Jadwal assessment day')">Assessment Day</button>
        </div>

        <div class="chat-input-area">
            <textarea id="chat-input" placeholder="Ketik pertanyaan Anda..." rows="1" aria-label="Pesan"></textarea>
            <button id="chat-send" aria-label="Kirim pesan" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="17" height="17">
                    <path d="M22 2L11 13M22 2L15 22 11 13 2 9l20-7z"/>
                </svg>
            </button>
        </div>

        <div class="chat-footer">
            <span>Powered by <strong>Telkom Indonesia</strong> ¬∑ Rekrutmen Support</span>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        const CHAT_CONFIG = {
            webhookUrl: 'http://localhost:5678/webhook/3aa9d728-74df-48b2-a7ff-0a66dac534b5/chat',
            typingDelay: { min: 500, max: 1200 }
        };

        (function () {
            const toggleBtn    = document.getElementById('chat-toggle');
            const chatWin      = document.getElementById('chat-window');
            const messagesEl   = document.getElementById('chat-messages');
            const inputEl      = document.getElementById('chat-input');
            const sendBtn      = document.getElementById('chat-send');
            const notifDot     = document.getElementById('chat-notif');
            const quickReplies = document.getElementById('chat-quick-replies');

            let isOpen    = false;
            let isWaiting = false;
            let sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).slice(2);

            toggleBtn.addEventListener('click', () => {
                isOpen = !isOpen;
                toggleBtn.classList.toggle('open', isOpen);
                chatWin.classList.toggle('open', isOpen);
                if (isOpen) {
                    notifDot.style.display = 'none';
                    if (messagesEl.children.length === 0) showGreeting();
                    setTimeout(() => inputEl.focus(), 320);
                }
            });

            function showGreeting() {
                setTimeout(() => {
                    addMessage('bot', 'Halo! Saya asisten virtual Helpdesk Rekrutmen Telkom Indonesia.\n\nAda yang bisa saya bantu seputar rekrutmen? üòä');
                }, 420);
            }

            function addMessage(role, text) {
                const wrap = document.createElement('div');
                wrap.className = 'chat-msg ' + role;
                const bubble = document.createElement('div');
                bubble.className = 'chat-bubble';
                bubble.textContent = text;
                const time = document.createElement('div');
                time.className = 'chat-msg-time';
                time.textContent = getNow();
                wrap.appendChild(bubble);
                wrap.appendChild(time);
                messagesEl.appendChild(wrap);
                scrollBottom();
            }

            function showTyping() {
                const el = document.createElement('div');
                el.className = 'chat-typing';
                el.id = 'chat-typing';
                el.innerHTML = '<span></span><span></span><span></span>';
                messagesEl.appendChild(el);
                scrollBottom();
            }
            function hideTyping() {
                const el = document.getElementById('chat-typing');
                if (el) el.remove();
            }

            async function sendMessage(text) {
                if (!text.trim() || isWaiting) return;
                addMessage('user', text.trim());
                inputEl.value = '';
                autoResize();
                setWaiting(true);
                quickReplies.style.display = 'none';

                const delay = CHAT_CONFIG.typingDelay.min + Math.random() * (CHAT_CONFIG.typingDelay.max - CHAT_CONFIG.typingDelay.min);
                showTyping();

                try {
                    const res = await fetch(CHAT_CONFIG.webhookUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chatInput: text.trim(), sessionId })
                    });
                    if (!res.ok) throw new Error('HTTP ' + res.status);
                    const data = await res.json();
                    const reply = data.output || data.text || data.message || data.answer
                        || (Array.isArray(data) && (data[0]?.output || data[0]?.text))
                        || 'Maaf, terjadi kesalahan. Silakan coba lagi.';
                    await wait(delay);
                    hideTyping();
                    addMessage('bot', reply);
                } catch (err) {
                    await wait(delay);
                    hideTyping();
                    addMessage('bot', 'Maaf, tidak dapat terhubung ke server. Silakan periksa koneksi Anda dan coba lagi.');
                    console.error('[Chatbot]', err);
                }
                setWaiting(false);
            }

            window.chatSendQuick = function (text) { sendMessage(text); };
            sendBtn.addEventListener('click', () => sendMessage(inputEl.value));
            inputEl.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(inputEl.value); }
            });
            inputEl.addEventListener('input', () => {
                sendBtn.disabled = inputEl.value.trim() === '' || isWaiting;
                autoResize();
            });

            function setWaiting(val) {
                isWaiting = val;
                inputEl.disabled = val;
                sendBtn.disabled = val || inputEl.value.trim() === '';
            }
            function autoResize() {
                inputEl.style.height = 'auto';
                inputEl.style.height = Math.min(inputEl.scrollHeight, 100) + 'px';
            }
            function scrollBottom() {
                setTimeout(() => { messagesEl.scrollTop = messagesEl.scrollHeight; }, 50);
            }
            function getNow() {
                return new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            }
            function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

        })();
    </script>

</body>
</html>